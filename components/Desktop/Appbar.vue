<template>
  <v-app-bar app dark color="blue darken-1">
    <v-toolbar-title></v-toolbar-title>
    <v-autocomplete
      v-model="selected"
      label="検索"
      clearable
      :items="islandList"
      @change="selectIsland"
      style="margin-top:30px;"
    ></v-autocomplete>
    <v-spacer />
    <!-- ログイン時:ユーザーのアバターとマイページへのリンク(まだ公開しない) -->
    <v-menu offset-y>
      <template v-slot:activator="{ on }">
        <v-btn v-on="on" class="mx-2" fab dark small color="green">
          <v-icon dark>mdi-island</v-icon>
        </v-btn>
      </template>
      <v-list>
        <v-list-item v-for="(item, index) in loginDropdown" :key="index">
          <nuxt-link :to="item.to">
            <v-list-item-title>{{ item.title }}</v-list-item-title>
          </nuxt-link>
        </v-list-item>
      </v-list>
    </v-menu>
  </v-app-bar>
</template>

<script>
import jsonData from "~/assets/index.json";
import { mapState, mapGetters } from "vuex";

export default {
  data() {
    return {
      title: "しまの時刻表",
      selected: "",
      loginDropdown: [
        {
          title: "時刻表検索",
          to: "/"
        },
        {
          title: "しまの時刻表について",
          to: "/about"
        },
      ],
      islandList: []
    };
  },
  created() {
    jsonData.index_items.forEach(item => {
      this.islandList.push(item.search_key);
    });
  },
  computed: {
    ...mapState(["mapState"])
  },
  methods: {
    selectIsland() {
      if (this.selected) {
        this.$store.dispatch(
          "focusIsland",
          this.islandList.indexOf(this.selected)
        );
      }
    }
  }
};
</script>
